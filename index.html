<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">





  <link rel="alternate" href="/atom.xml" title="This way up" type="application/atom+xml">






<meta name="description" content="be better">
<meta property="og:type" content="website">
<meta property="og:title" content="This way up">
<meta property="og:url" content="http://www.jcsama.com/index.html">
<meta property="og:site_name" content="This way up">
<meta property="og:description" content="be better">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="This way up">
<meta name="twitter:description" content="be better">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.jcsama.com/">





  <title>This way up</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">This way up</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">I am not perfect but I keep trying</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.jcsama.com/2021/09/11/php/php_mysql_charset/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jceee">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="This way up">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/09/11/php/php_mysql_charset/" itemprop="url">一个环境引发的乱码问题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-09-11T18:13:00+08:00">
                2021-09-11
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/php/" itemprop="url" rel="index">
                    <span itemprop="name">php</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p> 每个程序员多少都遇到过一些祖传代码，当代码能跑起来的时候并不可怕，可怕的是换了个环境，代码跑不起来了，这时脑里离不开这2个问题：”it can works ,why ?”  or  “it can`t works , why?”</p>
</blockquote>
<h2 id="u53D1_u73B0_u95EE_u9898"><a href="#u53D1_u73B0_u95EE_u9898" class="headerlink" title="发现问题"></a>发现问题</h2><p>有这一段代码，在服务器A中，从Mysql查出来的中文字段是正常显示的，从服务器B中显示的却是<code>???</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">$sql = <span class="string">"SELECT * from m_user limit 10"</span>;</span><br><span class="line">$db = <span class="keyword">new</span> MySQLi($host, $user, $pwd, $dbname, $port);</span><br><span class="line">$result = $db-&gt;query($sql);</span><br><span class="line">$output = $result-&gt;fetch_assoc();</span><br><span class="line">$result-&gt;free();</span><br><span class="line">var_dump($output);</span><br></pre></td></tr></table></figure>
<h2 id="u4FEE_u590D_u95EE_u9898"><a href="#u4FEE_u590D_u95EE_u9898" class="headerlink" title="修复问题"></a>修复问题</h2><p><code>MySQLi</code>很少用，现在基本都是用<code>PDO</code>了，遇到这问题第一反应是查函数文档，是不是有些奇怪的环境设置。</p>
<p>查到<code>MySQLi</code>编码相关有<code>set_charset</code>函数，而mysql连接也有<code></code>SET NAMES {charset}`可以指定编码，在使用代码指定编码后服务器B也可以正常使用：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">$db = <span class="keyword">new</span> MySQLi($host, $user, $pwd, $dbname, $port);</span><br><span class="line">$db-&gt;set_charset(<span class="string">"utf8"</span>);</span><br><span class="line"><span class="comment">// or $db-&gt;query("set names utf8");</span></span><br><span class="line">$result = $db-&gt;query($sql);</span><br></pre></td></tr></table></figure>
<p>指定编码是可以正常查询，那么我们再通过<code>get_charset</code>，看看各自连接默认使用的编码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$db = <span class="keyword">new</span> MySQLi($host, $user, $pwd, $dbname, $port);</span><br><span class="line">var_dump($db-&gt;get_charset());</span><br></pre></td></tr></table></figure>
<p>发现正常的机器上使用的是<code>utf8</code>，乱码机器上的是<code>latin1</code></p>
<h2 id="u6392_u67E5_u95EE_u9898"><a href="#u6392_u67E5_u95EE_u9898" class="headerlink" title="排查问题"></a>排查问题</h2><p>我们发现问题在于php与mysql连接时，默认编码不一致，我们排查一下php与mysql的连接扩展有没有问题</p>
<p>通过<code>php -i</code> 命令查看mysql client使用的版本</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="comment">//默认utf8的机器:</span></span><br><span class="line">mysqli</span><br><span class="line">Client API library version =&gt; 5.5.19</span><br><span class="line">---------------------</span><br><span class="line"><span class="comment">//默认latin1的机器：</span></span><br><span class="line">mysqli</span><br><span class="line">Client API library version =&gt; 5.5.68-MariaDB</span><br></pre></td></tr></table></figure>
<p>通过对比，我们发现两者的版本并不一致，有问题的机器使用的是<code>MariaDB</code>，通过wifi百科发现这是个社区开发的，兼容mysql协议的开源数据库管理系统。</p>
<p><code>MariaDB</code>的API和协议兼容MySQL，使用是没有问题的，但<code>MariaDB</code>的默认编码是<code>latin1</code>，那这很可能就是问题根源。</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="keyword">In</span> MariaDB, the<span class="built_in"> default </span>character <span class="builtin-name">set</span> is latin1, <span class="keyword">and</span> the<span class="built_in"> default </span>collation is latin1_swedish_ci</span><br></pre></td></tr></table></figure>
<p>尝试修改php连接mysql的 Client API library，安装mysqlmysql_5.5.19 lib包，改原来使用包的软链，发现代码正常运行，问题解决～</p>
<h2 id="u540E_u8BB0"><a href="#u540E_u8BB0" class="headerlink" title="后记"></a>后记</h2><p>我们可以通过docker之类的工具，保持统一的环境，但从开发的解决还是尽量维护代码健壮性，通过代码指定连接使用的编码，这样换一个差不多的环境也能正常运行，可以少折腾一些环境</p>
<h2 id="u53C2_u8003"><a href="#u53C2_u8003" class="headerlink" title="参考"></a>参考</h2><ul>
<li><a href="/MariaDB">MariaDB</a></li>
<li><a href="https://mariadb.com/kb/en/setting-character-sets-and-collations/" target="_blank" rel="noopener">MariaDb Default Charset</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.jcsama.com/2021/06/26/git/split-git-repository/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jceee">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="This way up">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/06/26/git/split-git-repository/" itemprop="url">拆分Git仓库并保存提交记录</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-06-26T22:48:38+08:00">
                2021-06-26
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/git/" itemprop="url" rel="index">
                    <span itemprop="name">git</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>分分合合是常态，大项目有时会有拆分的需求，当想拆分git项目，又想保留提交记录时，可以按下面流程操作</p>
</blockquote>
<h2 id="u57FA_u672C_u8BBE_u5B9A"><a href="#u57FA_u672C_u8BBE_u5B9A" class="headerlink" title="基本设定"></a>基本设定</h2><p>父项目为 <code>https://github.com/xxx/demo.git</code></p>
<p>父仓库目录：/demo</p>
<p>当前子仓库目录：/demo/target_child</p>
<p>目标是把target_child拆到新项目：<code>https://github.com/xxx/target_child.git</code></p>
<h2 id="step1_clone__u4E00_u4EFD_u539F_u4ED3_u5E93_u6587_u4EF6_u5230_u672C_u5730_uFF0C_u76EE_u5F55_u4E3A_u76EE_u6807_u6587_u4EF6_u5939"><a href="#step1_clone__u4E00_u4EFD_u539F_u4ED3_u5E93_u6587_u4EF6_u5230_u672C_u5730_uFF0C_u76EE_u5F55_u4E3A_u76EE_u6807_u6587_u4EF6_u5939" class="headerlink" title="step1 clone 一份原仓库文件到本地，目录为目标文件夹"></a>step1 clone 一份原仓库文件到本地，目录为目标文件夹</h2><figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">​cd ~/git/code/</span><br><span class="line">​</span><br><span class="line">​git <span class="keyword">clone</span> <span class="title">https</span>://github.com/xxx/demo.git target_child</span><br><span class="line">​</span><br></pre></td></tr></table></figure>
<h2 id="step2__u5220_u6389_u539F_u4ED3_u5E93_u7684remote"><a href="#step2__u5220_u6389_u539F_u4ED3_u5E93_u7684remote" class="headerlink" title="step2 删掉原仓库的remote"></a>step2 删掉原仓库的remote</h2><figure class="highlight stata"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">cd</span> target_child</span><br><span class="line"></span><br><span class="line">git remote <span class="keyword">rm</span> origin</span><br></pre></td></tr></table></figure>
<h2 id="step3__u8FC7_u6EE4_u65E0_u7528_u7684_u5386_u53F2_u8BB0_u5F55"><a href="#step3__u8FC7_u6EE4_u65E0_u7528_u7684_u5386_u53F2_u8BB0_u5F55" class="headerlink" title="step3 过滤无用的历史记录"></a>step3 过滤无用的历史记录</h2><p>过滤所有历史提交，只保留对指定子目录有影响的提交. 命令执行完毕后，就可以看到本地的新仓库已经是原仓库子目录中的内容了，且保留了关于该子目录所有的提交历史。</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">git filter-branch --tag-name-filter cat --prune-empty --subdirectory-filter ./target_child -- --all</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>参数</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>–tag-name-filter</td>
<td>该参数控制我们要如何处理旧的 tag，cat 即表示原样输出</td>
</tr>
<tr>
<td>–prune-empty</td>
<td>删除空的（对子目录没有影响的）提交</td>
</tr>
<tr>
<td>–subdirectory-filter</td>
<td>指定子目录路径, 如<code>./target_child</code></td>
</tr>
<tr>
<td>– –all</td>
<td>该参数必须跟在<code>--</code>后面，表示对所有分支进行操作。如果你只想保存当前分支，也可以不添加此参数。</td>
</tr>
</tbody>
</table>
<h2 id="step_4__u6E05_u7406-git_u7684object"><a href="#step_4__u6E05_u7406-git_u7684object" class="headerlink" title="step 4 清理.git的object"></a>step 4 清理.git的object</h2><p><code>.git</code> 目录里还是保存有不少无用的object，我们需要将其清除掉以减小新仓库的体积.</p>
<p>PS: <code>git gc</code>操作耗时比较久,请耐心等待.</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">git reset --hard</span><br><span class="line"></span><br><span class="line">git for-each-ref --format="%(refname)" refs/original/ |xargs -n 1 git update-ref -d</span><br><span class="line"></span><br><span class="line">git reflog expire --expire=now --all</span><br><span class="line"></span><br><span class="line">git gc --aggressive --prune=now</span><br></pre></td></tr></table></figure>
<h2 id="step_5__u5C06_u65B0_u7684_u672C_u5730_u4ED3_u5E93_u63A8_u9001_u5230_u8FDC_u7AEF"><a href="#step_5__u5C06_u65B0_u7684_u672C_u5730_u4ED3_u5E93_u63A8_u9001_u5230_u8FDC_u7AEF" class="headerlink" title="step 5 将新的本地仓库推送到远端"></a>step 5 将新的本地仓库推送到远端</h2><p>先创建新的仓库：<code>https://github.com/xxx/target_child.git</code></p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">//添加远端分支</span><br><span class="line"></span><br><span class="line">git remote add origin https://github.com/xxx/target_child.git</span><br><span class="line"></span><br><span class="line">//强制推送到远端</span><br><span class="line"></span><br><span class="line">git push --fore origin master</span><br></pre></td></tr></table></figure>
<p>PS:</p>
<p>若master分支为保护状态，强制推送时会遇到如下错误：</p>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">remote: GitLab: You are not allowed to force push code to a protected branch on this project.</span></span><br></pre></td></tr></table></figure>
<p>须解除master分支的保护状态，推完之后再改回来</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.jcsama.com/2021/06/10/mysql/mysql-abs/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jceee">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="This way up">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2021/06/10/mysql/mysql-abs/" itemprop="url">mysql abs func</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2021-06-10T23:15:47+08:00">
                2021-06-10
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/mysql/" itemprop="url" rel="index">
                    <span itemprop="name">mysql</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>ABS(<em>number</em>)</p>
<p>Return the absolute value of a number</p>
</blockquote>
<h2 id="u57FA_u672C_u7528_u6CD5"><a href="#u57FA_u672C_u7528_u6CD5" class="headerlink" title="基本用法"></a>基本用法</h2><p>返回数字参数的绝对值</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="built_in">ABS</span>(<span class="number">-243.5</span>);     ===&gt; 243.5</span><br></pre></td></tr></table></figure>
<h2 id="u65E0_u7B26_u53F7_u6570_u5B57_u76F8_u51CF_u8BA1_u7B97_u5F02_u5E38_u95EE_u9898"><a href="#u65E0_u7B26_u53F7_u6570_u5B57_u76F8_u51CF_u8BA1_u7B97_u5F02_u5E38_u95EE_u9898" class="headerlink" title="无符号数字相减计算异常问题"></a>无符号数字相减计算异常问题</h2><p>例子：创建用户表，年龄字段为非负</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">CREATE TABLE `user` (</span><br><span class="line">  `uid` int(11) unsigned <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT COMMENT <span class="string">'uid'</span>,</span><br><span class="line">  `age` int(10) unsigned <span class="keyword">NOT</span> <span class="literal">NULL</span> COMMENT <span class="string">'年龄'</span>,</span><br><span class="line">  `name` varchar(50) <span class="keyword">NOT</span> <span class="literal">NULL</span><span class="built_in"> DEFAULT </span><span class="string">''</span> COMMENT <span class="string">'用户名'</span>,</span><br><span class="line">  PRIMARY KEY (`uid`)</span><br><span class="line">) <span class="attribute">ENGINE</span>=InnoDB <span class="attribute">AUTO_INCREMENT</span>=1<span class="built_in"> DEFAULT </span><span class="attribute">CHARSET</span>=utf8mb4 COMMENT <span class="string">'用户表'</span>;</span><br></pre></td></tr></table></figure>
<p>写入几条测试数据</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">INSERT</span> <span class="selector-tag">INTO</span> `<span class="selector-tag">user</span>` ( <span class="built_in">`age`</span>, <span class="built_in">`name`</span>)</span><br><span class="line"><span class="selector-tag">VALUES</span></span><br><span class="line">	( <span class="number">11</span>, <span class="string">'张小明'</span>),</span><br><span class="line">	( <span class="number">26</span>, <span class="string">'林小红'</span>),</span><br><span class="line">	( <span class="number">21</span>, <span class="string">'李小狼'</span>),</span><br><span class="line">	( <span class="number">18</span>, <span class="string">'陈小洋'</span>);</span><br></pre></td></tr></table></figure>
<p>当我们想找出年龄最接近25岁的用户时，会出现Mysql错误：</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">select *,ABS(age - 25) as age_sort <span class="keyword">from</span><span class="built_in"> user </span>order by age_sort asc limit 1;</span><br><span class="line">===&gt;BIGINT UNSIGNED value is out of range <span class="keyword">in</span> <span class="string">'(`user`.`age` - 25)'</span></span><br></pre></td></tr></table></figure>
<p>解决方法：使用cast把无符号age转为带符号的number</p>
<figure class="highlight n1ql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> *,<span class="built_in">ABS</span>(<span class="keyword">CAST</span>(age <span class="keyword">AS</span> SIGNED) - <span class="number">25</span>) <span class="keyword">as</span> age_sort </span><br><span class="line"><span class="keyword">from</span> <span class="symbol">`user`</span> <span class="keyword">order</span> <span class="keyword">by</span> age_sort <span class="keyword">asc</span> <span class="keyword">limit</span> <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.jcsama.com/2019/04/23/golang/defer/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jceee">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="This way up">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2019/04/23/golang/defer/" itemprop="url">GO学习笔记--defer篇</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-04-23T22:33:16+08:00">
                2019-04-23
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/golang/" itemprop="url" rel="index">
                    <span itemprop="name">golang</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="u4EC0_u4E48_u662Fdefer"><a href="#u4EC0_u4E48_u662Fdefer" class="headerlink" title="什么是defer"></a>什么是defer</h1><h1 id="defer_u7279_u522B"><a href="#defer_u7279_u522B" class="headerlink" title="defer特别"></a>defer特别</h1><p>栈，后进先出</p>
<h1 id="u4EC0_u4E48_u573A_u666F_u4E0B_u7528defer"><a href="#u4EC0_u4E48_u573A_u666F_u4E0B_u7528defer" class="headerlink" title="什么场景下用defer"></a>什么场景下用defer</h1><p>程序员在编程的时候，经常需要打开一些资源，比如数据库连接、文件、锁等，这些资源需要在用完之后释放掉，否则会造成内存泄漏。</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span> <span class="params">()</span></span>&#123;</span><br><span class="line">	f,err := os.Open(<span class="string">"test.txt"</span>)</span><br><span class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">		fmt.Print(err, <span class="string">"\n"</span>)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">defer</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">		fmt.Print(<span class="string">"do close \n"</span>)</span><br><span class="line">		closeErr := f.Close()</span><br><span class="line">		<span class="keyword">if</span> closeErr != <span class="literal">nil</span> &#123;</span><br><span class="line">			fmt.Print(<span class="string">"close file err \n"</span>)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">		&#125;</span><br><span class="line">	&#125;()</span><br><span class="line">	fmt.Print(<span class="string">"main end \n"</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="defer_u539F_u7406"><a href="#defer_u539F_u7406" class="headerlink" title="defer原理"></a>defer原理</h1><p>每次defer语句执行的时候，会把函数“压栈”，函数参数会被拷贝下来；当外层函数（非代码块，如一个for循环）退出时，defer函数按照定义的逆序执行；如果defer执行的函数为nil, 那么会在最终调用函数的产生panic.<br>defer语句并不会马上执行，而是会进入一个栈，函数return前，会按先进后出的顺序执行。也说是说最先被定义的defer语句最后执行。先进后出的原因是后面定义的函数可能会依赖前面的资源，自然要先执行；否则，如果前面先执行，那后面函数的依赖就没有了。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.jcsama.com/2018/11/20/IDE/vscode/go-ide-vscode/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="jceee">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="This way up">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/11/20/IDE/vscode/go-ide-vscode/" itemprop="url">GO语言IDE篇--Vscode (Mac)</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-11-20T23:26:46+08:00">
                2018-11-20
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>工欲善其事，必先利其器<br>—-《论语·卫灵公》</p>
</blockquote>
<h2 id="u524D_u8A00"><a href="#u524D_u8A00" class="headerlink" title="前言"></a>前言</h2><p>当我们开始学习一个编程语言时，第一步就是选择一款编码工具，我们使用工具的主要目的是提高我们的效率： </p>
<ul>
<li>语法高亮(基本都有)</li>
<li>支持DEBUG</li>
<li>插件丰富</li>
<li>集成终端</li>
<li>颜值（这个也很重要啊喂！）</li>
</ul>
<p>对比多款式工具后，jetbrains系列收费，LiteIDE略丑，Vim学习曲线高…最后我选择了满足了我的所有要求的Vscode，下面开始撸之～</p>
<h2 id="u5B89_u88C5GO_u73AF_u5883"><a href="#u5B89_u88C5GO_u73AF_u5883" class="headerlink" title="安装GO环境"></a>安装GO环境</h2><p>这里假设我们已经安装完基础环境并配置好了环境变量，略过…</p>
<h2 id="u5B89_u88C5vscode"><a href="#u5B89_u88C5vscode" class="headerlink" title="安装vscode"></a>安装vscode</h2><p><a href="https://code.visualstudio.com/" target="_blank" rel="noopener">vscode官网</a>下之</p>
<h2 id="u5B89_u88C5go_u63D2_u4EF6"><a href="#u5B89_u88C5go_u63D2_u4EF6" class="headerlink" title="安装go插件"></a>安装go插件</h2><h3 id="u57FA_u7840_u63D2_u4EF6"><a href="#u57FA_u7840_u63D2_u4EF6" class="headerlink" title="基础插件"></a>基础插件</h3><p>打开vscode，打开插件搜索，输入go，安装之:<br><img src="/images/go-vscode/go-extend.png" alt="插件安装"></p>
<h3 id="u5B89_u88C5_u4F9D_u8D56_u5305_u652F_u6301"><a href="#u5B89_u88C5_u4F9D_u8D56_u5305_u652F_u6301" class="headerlink" title="安装依赖包支持"></a>安装依赖包支持</h3><figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">$ <span class="built_in">mkdir</span> -<span class="keyword">p</span> $GOPAH/src/golang.org/<span class="keyword">x</span></span><br><span class="line">$ <span class="keyword">cd</span> $GOPAH/src/golang.org/<span class="keyword">x</span></span><br><span class="line">$ git clone http<span class="variable">s:</span>//github.<span class="keyword">com</span>/golang/tools.git tools</span><br><span class="line"></span><br><span class="line">$ <span class="keyword">go</span> <span class="built_in">get</span> -<span class="keyword">u</span>  github.<span class="keyword">com</span>/ramya-rao-<span class="keyword">a</span>/<span class="keyword">go</span>-outline</span><br><span class="line">$ <span class="keyword">go</span> <span class="built_in">get</span> -<span class="keyword">u</span>  github.<span class="keyword">com</span>/acroca/<span class="keyword">go</span>-symbols</span><br><span class="line">$ <span class="keyword">go</span> install golang.org/<span class="keyword">x</span>/tools/cmd/guru</span><br><span class="line">$ <span class="keyword">go</span> install golang.org/<span class="keyword">x</span>/tools/cmd/gorename</span><br><span class="line">$ <span class="keyword">go</span> <span class="built_in">get</span> -<span class="keyword">u</span> github.<span class="keyword">com</span>/rogpeppe/godef</span><br><span class="line">$ <span class="keyword">go</span> <span class="built_in">get</span> -<span class="keyword">u</span> github.<span class="keyword">com</span>/sqs/goreturns</span><br><span class="line">$ <span class="keyword">go</span> <span class="built_in">get</span> -<span class="keyword">u</span> github.<span class="keyword">com</span>/ramya-rao-<span class="keyword">a</span>/<span class="keyword">go</span>-outline</span><br><span class="line">$ <span class="keyword">go</span> <span class="built_in">get</span> -<span class="keyword">u</span> github.<span class="keyword">com</span>/josharian/impl</span><br><span class="line">$ <span class="keyword">go</span> <span class="built_in">get</span> -<span class="keyword">u</span> golang.org/<span class="keyword">x</span>/lint/golint</span><br><span class="line">$ <span class="keyword">go</span> <span class="built_in">get</span> -<span class="keyword">u</span> github.<span class="keyword">com</span>/cweill/gotests/gotests</span><br></pre></td></tr></table></figure>
<h3 id="u5B89_u88C5dlv"><a href="#u5B89_u88C5dlv" class="headerlink" title="安装dlv"></a>安装dlv</h3><p>go的debug依赖于dlv</p>
<p>安装dlv有2种途径:</p>
<h4 id="brew_u5B89_u88C5dlv"><a href="#brew_u5B89_u88C5dlv" class="headerlink" title="brew安装dlv"></a>brew安装dlv</h4><p>这个帮你解决了证书等问题</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">$ brew <span class="keyword">install</span> <span class="keyword">go</span>-delve/delve/delve</span><br></pre></td></tr></table></figure>
<h4 id="go_get_u5B89_u88C5dlv"><a href="#go_get_u5B89_u88C5dlv" class="headerlink" title="go get安装dlv"></a>go get安装dlv</h4><p>安装dlv</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ go get github.com<span class="regexp">/derekparker/</span>delve<span class="regexp">/cmd/</span>dlv</span><br><span class="line"></span><br><span class="line">-- 查看是否安装成功</span><br><span class="line">$ <span class="variable">$GOPATH</span><span class="regexp">/bin/</span>dlv version</span><br></pre></td></tr></table></figure>
<p>把dlv从<code>GOPATH</code>移动到<code>GOROOT</code></p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ sudo mv <span class="variable">$GOPATH</span><span class="regexp">/bin/</span>dlv <span class="variable">$GOROOT</span><span class="regexp">/bin/</span>dlv</span><br></pre></td></tr></table></figure>
<p>创建系统证书</p>
<figure class="highlight basic"><table><tr><td class="code"><pre><span class="line"><span class="symbol">1 </span>打开<span class="string">"钥匙串访问"</span></span><br><span class="line"><span class="symbol">2 </span>打开菜单 钥匙串访问/证书助理/创建证书...</span><br><span class="line"><span class="symbol">3 </span>名称: dlv-cert 身份类型: 自签名证书 证书类型: 代码签名 并 选择<span class="string">"让我覆盖这些默认值"</span></span><br><span class="line"><span class="symbol">4 </span>单击<span class="string">"继续"</span>, 有效期(天数): <span class="number">365</span> 这里你可以自己修改, 我改为<span class="number">3650</span></span><br><span class="line"><span class="symbol">5 </span>一路继续下去, 直到看到<span class="string">"指定用于该证书的位置"</span> 钥匙串 选择 <span class="string">"系统"</span> 并单击<span class="string">"创建"</span>按钮</span><br><span class="line"><span class="symbol">6 </span>重启系统之后, 再打开<span class="string">"钥匙串访问"</span>, 选择<span class="string">"系统"</span>, 就会看到创建好的<span class="string">"dlv-cert"</span>证书.</span><br><span class="line"><span class="symbol">7 </span>右键<span class="string">"dlv-cert"</span>证书, 选择<span class="string">"显示简介"</span>-&gt;<span class="string">"信任"</span>-&gt;<span class="string">"代码签名"</span> 修改为: 始终信任</span><br></pre></td></tr></table></figure>
<p>分配证书</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">$ sudo codesign -s <span class="string">"dlv-cert"</span> <span class="variable">$GOROOT</span><span class="regexp">/bin/</span>dlv</span><br></pre></td></tr></table></figure>
<p>如果调试时遇到下面问题：</p>
<figure class="highlight smali"><table><tr><td class="code"><pre><span class="line">could<span class="built_in"> not </span>launch process: debugserver<span class="built_in"> or </span>lldb-server<span class="built_in"> not </span>found: install XCode's command line tools<span class="built_in"> or </span>lldb-server</span><br></pre></td></tr></table></figure>
<p>可以安装一下xcode-select:</p>
<figure class="highlight ada"><table><tr><td class="code"><pre><span class="line">xcode-<span class="keyword">select</span> <span class="comment">--install</span></span><br></pre></td></tr></table></figure>
<h2 id="u5F00_u59CB_u8C03_u8BD5"><a href="#u5F00_u59CB_u8C03_u8BD5" class="headerlink" title="开始调试"></a>开始调试</h2><p>创建个必写的hello world文件：</p>
<figure class="highlight go"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">"fmt"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">	<span class="keyword">var</span> h <span class="keyword">string</span> = <span class="string">"こんにちは"</span></span><br><span class="line">	<span class="keyword">var</span> w <span class="keyword">string</span> = <span class="string">"世界"</span></span><br><span class="line">	fmt.Println(h, w)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后开始debug<br><img src="/images/go-vscode/start-debug.png" alt="开始debug"></p>
<p>如果是第一次调试，会让你编辑launch.json文件</p>
<p>我们加一个配置：<br><figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"name"</span>: <span class="string">"helloword"</span>,</span><br><span class="line">    <span class="attr">"type"</span>: <span class="string">"go"</span>,</span><br><span class="line">    <span class="attr">"request"</span>: <span class="string">"launch"</span>,</span><br><span class="line">    <span class="attr">"mode"</span>: <span class="string">"debug"</span>,</span><br><span class="line">    <span class="attr">"env"</span>: &#123;&#125;,</span><br><span class="line">    <span class="attr">"program"</span>: <span class="string">"$&#123;workspaceRoot&#125;/hello/helloworld.go"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>program是调试文件的地址，${workspaceRoot}是项目的根目录，根据实际情况改</p>
<p>保存，再跑一下debug：<br><img src="/images/go-vscode/debug.png" alt="开始debug"></p>
<p>这样就完成了～</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">jceee</p>
              <p class="site-description motion-element" itemprop="description">be better</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">46</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">15</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">22</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">jceee</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
